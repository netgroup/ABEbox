version: '3'

services:

        mongo:
                image: mongo
                container_name: mongo
                restart: always
                #ports:
                #        - 27017-27019:27017-27019
                environment:
                        MONGO_INITDB_DATABASE: users
                        MONGO_INITDB_ROOT_USERNAME: root
                        MONGO_INITDB_ROOT_PASSWORD: abebox
                volumes:
                        - ./init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
                        - ./mongo-volume:/data/db
                networks:
                        abe_network:
                                ipv4_address: 172.25.0.3

        mongo-express:
                image: mongo-express
                container_name: mongo-express
                restart: always
                depends_on:
                        - mongo
                environment:
                #        ME_CONFIG_MONGODB_SERVER: mongo
                #        ME_CONFIG_MONGODB_PORT: 27017
                #        ME_CONFIG_MONGODB_ENABLE_ADMIN: "false"
                #        ME_CONFIG_MONGODB_AUTH_DATABASE: admin
                #        ME_CONFIG_MONGODB_AUTH_USERNAME: root
                #        ME_CONFIG_MONGODB_AUTH_PASSWORD: abebox
                #        ME_CONFIG_BASICAUTH_USERNAME: admin
                #        ME_CONFIG_BASICAUTH_PASSWORD: admin
                        ME_CONFIG_MONGODB_ADMINUSERNAME: root
                        ME_CONFIG_MONGODB_ADMINPASSWORD: abebox
                networks:
                        abe_network:
                                ipv4_address: 172.25.0.4

        cpabe_webserver:
                build:
                        context: .
                        dockerfile: CP_ABE_Dockerfile
                image: cpabe_webserver
                container_name: cpabe_webserver
                depends_on:
                        - mongo
                ports:
                        - "5002:5002"
                networks:
                        abe_network:
                                ipv4_address: 172.25.0.2

networks:
        abe_network:
                driver: bridge
                ipam:
                        config:
                                - subnet: 172.25.0.0/16

volumes:
        persistent: